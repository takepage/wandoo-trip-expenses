<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏßÑÏßúÎ∞∞Í∏∞ Ïó¨Ìñâ Í≤ΩÎπÑ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        
        /* ÏõåÌÑ∞ÌååÌÅ¨ ÌÖåÎßà CSS */
        .water-theme {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .water-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .water-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .water-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Î¨ºÎ∞©Ïö∏ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes bubble {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-20px) scale(1.1); opacity: 0; }
        }
        
        .bubble {
            animation: bubble 2s infinite;
        }
        
        /* Ïù¥Ïä§ÌÑ∞ÏóêÍ∑∏ Ïä§ÌÉÄÏùº */
        .easter-egg {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .easter-egg:hover {
            transform: scale(1.05);
        }
        
        /* Î™®Î∞îÏùº ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
        .mobile-button {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            cursor: pointer;
        }
        
        /* Î©îÎâ¥ Ïä§ÌÉÄÏùº Í∞úÏÑ† */
        .menu-dropdown {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.3), 
                0 10px 10px -5px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }
        
        .menu-item {
            transition: all 0.2s ease;
        }
        
        .menu-item:hover {
            transform: translateX(2px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // üé® ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§ (lucide ÎåÄÏã† Îã®Ïàú ÌÖçÏä§Ìä∏/Ïù¥Î™®ÏßÄ)
        const Plus = () => React.createElement('span', null, '+');
        const Check = () => React.createElement('span', null, '‚úì');
        const MoreVertical = () => React.createElement('span', null, '‚ãÆ');
        const Edit3 = () => React.createElement('span', null, '‚úèÔ∏è');
        const Trash2 = () => React.createElement('span', null, 'üóëÔ∏è');
        const Users = () => React.createElement('span', null, 'üë•');
        const AlertCircle = () => React.createElement('span', null, '‚ö†Ô∏è');
        const Wifi = () => React.createElement('span', null, 'üì∂');
        const ChevronDown = () => React.createElement('span', null, '‚ñº');
        const ChevronUp = () => React.createElement('span', null, '‚ñ≤');
        const Waves = () => React.createElement('span', null, 'üåä');
        const Droplets = () => React.createElement('span', null, 'üíß');

        // üî• Firebase ÏÑ§Ï†ï (ÏßÄÏó≠ URL ÏàòÏ†ï)
        const firebaseConfig = {
            apiKey: "AIzaSyBn2VFGn7dQHaXCrWOeVhtQFRSd9wjPMao",
            authDomain: "wandoo-trip-expenses.firebaseapp.com",
            databaseURL: "https://wandoo-trip-expenses-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wandoo-trip-expenses",
            storageBucket: "wandoo-trip-expenses.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Firebase Ï¥àÍ∏∞Ìôî ÏïàÏ†ÑÏÑ± Í≤ÄÏÇ¨
        let database;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            database = firebase.database();
            console.log('‚úÖ Firebase Ïó∞Í≤∞ ÏÑ±Í≥µ');
        } catch (error) {
            console.error('‚ùå Firebase Ïó∞Í≤∞ Ïã§Ìå®:', error);
            // Firebase Ïó∞Í≤∞ Ïã§Ìå® Ïãú Î°úÏª¨ Î™®ÎìúÎ°ú ÎèôÏûë
            database = null;
        }

        // üèä‚Äç‚ôÄÔ∏è ÏÉàÎ°úÏö¥ Ïó¨Ìñâ Î©§Î≤Ñ (6Î™Ö) + ÌôúÎèô Î°úÍ∑∏ ÏÉÅÌÉú
        const members = ['ÌÉúÏõÖ', 'Ïû¨Ïõê', 'Ïû¨Ìóå', 'ÏäπÏö∞', 'ÌÉúÌò∏', 'ÏßÑÌòï'];
        
        const categories = [
            { id: 'transport', name: 'ÍµêÌÜµÎπÑ', icon: 'üöó', color: 'bg-blue-100 text-blue-800' },
            { id: 'accommodation', name: 'ÏàôÎ∞ïÎπÑ', icon: 'üè†', color: 'bg-green-100 text-green-800' },
            { id: 'food', name: 'ÏãùÎπÑ', icon: 'üçñ', color: 'bg-orange-100 text-orange-800' },
            { id: 'activity', name: 'ÌôúÎèôÎπÑ', icon: 'üèä‚Äç‚ôÄÔ∏è', color: 'bg-purple-100 text-purple-800' },
            { id: 'other', name: 'Í∏∞ÌÉÄ', icon: 'üí¶', color: 'bg-gray-100 text-gray-800' }
        ];

        // üíú ÌôúÎèô Î°úÍ∑∏ ÏãúÏä§ÌÖú Ï∂îÍ∞Ä
        const [activityLogs, setActivityLogs] = useState([]);
        const [showGirlfriendView, setShowGirlfriendView] = useState(false);
        const [showActivityForm, setShowActivityForm] = useState(false);
        const [newActivity, setNewActivity] = useState('');

        function App() {
            // ÏÉÅÌÉú Í¥ÄÎ¶¨
            const [expenses, setExpenses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [connected, setConnected] = useState(false);
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingExpense, setEditingExpense] = useState(null);
            const [expandedExpenses, setExpandedExpenses] = useState({});
            const [showExpenseMenu, setShowExpenseMenu] = useState({});
            
            // üéñÔ∏è Ïù¥Ïä§ÌÑ∞ÏóêÍ∑∏ ÏÉÅÌÉú
            const [clickCount, setClickCount] = useState(0);
            const [showEasterEgg, setShowEasterEgg] = useState(false);
            const [easterEggMessage, setEasterEggMessage] = useState('');

            // üíú ÌôúÎèô Î°úÍ∑∏ ÏãúÏä§ÌÖú ÏÉÅÌÉú
            const [activityLogs, setActivityLogs] = useState([]);
            const [showGirlfriendView, setShowGirlfriendView] = useState(false);
            const [showActivityForm, setShowActivityForm] = useState(false);
            const [newActivity, setNewActivity] = useState('');
            const [pokeNotifications, setPokeNotifications] = useState([]);

            // Ìèº ÏÉÅÌÉú
            const [formData, setFormData] = useState({
                title: '',
                amount: '',
                payer: members[0],
                participants: [...members],
                category: 'food',
                splitType: 'equal',
                customSplit: {},
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5)
            });

            // üî• Firebase Ïó∞Í≤∞ Î∞è Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî (ÏïàÏ†Ñ Î≤ÑÏ†Ñ)
            useEffect(() => {
                console.log('üî• Firebase Ïó∞Í≤∞ ÏãúÏûë...');
                
                // FirebaseÍ∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨ Î™®ÎìúÎ°ú ÎèôÏûë
                if (!database) {
                    console.log('‚ö†Ô∏è Firebase Ïó∞Í≤∞ Î∂àÍ∞Ä, Î°úÏª¨ Î™®ÎìúÎ°ú ÎèôÏûë');
                    setConnected(false);
                    setLoading(false);
                    return;
                }

                try {
                    const expensesRef = database.ref('expenses');
                    const activityRef = database.ref('activities');
                    const pokeRef = database.ref('pokes');
                    
                    // Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
                    const connectedRef = database.ref('.info/connected');
                    connectedRef.on('value', (snapshot) => {
                        const isConnected = snapshot.val() === true;
                        console.log('üåä Ïó∞Í≤∞ ÏÉÅÌÉú:', isConnected);
                        setConnected(isConnected);
                    });

                    // Í≤ΩÎπÑ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî
                    expensesRef.on('value', (snapshot) => {
                        console.log('üìä Í≤ΩÎπÑ Îç∞Ïù¥ÌÑ∞ ÏàòÏã†:', snapshot.val());
                        const data = snapshot.val();
                        if (data) {
                            const expensesList = Object.keys(data).map(key => {
                                const expense = data[key];
                                return {
                                    ...expense,
                                    id: key,
                                    participants: expense.participants || [],
                                    completedBy: expense.completedBy || {},
                                    customSplit: expense.customSplit || {},
                                    amount: expense.amount || 0,
                                    payer: expense.payer || '',
                                    title: expense.title || '',
                                    category: expense.category || 'other',
                                    date: expense.date || new Date().toISOString().split('T')[0],
                                    time: expense.time || '00:00'
                                };
                            });
                            setExpenses(expensesList);
                            console.log('‚úÖ Í≤ΩÎπÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å:', expensesList.length, 'Í∞ú');
                        } else {
                            setExpenses([]);
                            console.log('üìù Í≤ΩÎπÑ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                        }
                        setLoading(false);
                    });

                    // üíú ÌôúÎèô Î°úÍ∑∏ ÎèôÍ∏∞Ìôî
                    activityRef.on('value', (snapshot) => {
                        console.log('üìù ÌôúÎèô Î°úÍ∑∏ ÏàòÏã†:', snapshot.val());
                        const data = snapshot.val();
                        if (data) {
                            const logsList = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            })).sort((a, b) => b.timestamp - a.timestamp); // ÏµúÏã†Ïàú
                            setActivityLogs(logsList);
                            console.log('‚úÖ ÌôúÎèô Î°úÍ∑∏ Î°úÎìú ÏôÑÎ£å:', logsList.length, 'Í∞ú');
                        } else {
                            setActivityLogs([]);
                        }
                    });

                    // üíú Ï∞åÎ•¥Í∏∞ ÏïåÎ¶º ÎèôÍ∏∞Ìôî
                    pokeRef.on('value', (snapshot) => {
                        console.log('üíú Ï∞åÎ•¥Í∏∞ ÏïåÎ¶º ÏàòÏã†:', snapshot.val());
                        const data = snapshot.val();
                        if (data) {
                            const pokeList = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            })).sort((a, b) => b.timestamp - a.timestamp);
                            setPokeNotifications(pokeList);
                            
                            // ÏÉàÎ°úÏö¥ Ï∞åÎ•¥Í∏∞Í∞Ä ÏûàÏúºÎ©¥ ÏïåÎ¶º ÌëúÏãú
                            const latestPoke = pokeList[0];
                            if (latestPoke && (Date.now() - latestPoke.timestamp < 10000)) {
                                alert(`üíú ${latestPoke.message}`);
                                setShowActivityForm(true);
                            }
                        } else {
                            setPokeNotifications([]);
                        }
                    });

                    // ÌÉÄÏûÑÏïÑÏõÉ ÏÑ§Ï†ï (10Ï¥à ÌõÑ Í∞ïÏ†ú Î°úÎî© ÏôÑÎ£å)
                    const timeout = setTimeout(() => {
                        console.log('‚è∞ Î°úÎî© ÌÉÄÏûÑÏïÑÏõÉ, Í∞ïÏ†ú ÏôÑÎ£å');
                        setLoading(false);
                    }, 10000);

                    // Ïª¥Ìè¨ÎÑåÌä∏ Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Î¶¨Ïä§ÎÑà Ìï¥Ï†ú
                    return () => {
                        console.log('üîÑ Firebase Î¶¨Ïä§ÎÑà Ìï¥Ï†ú');
                        clearTimeout(timeout);
                        expensesRef.off();
                        activityRef.off();
                        pokeRef.off();
                        connectedRef.off();
                    };
                } catch (error) {
                    console.error('‚ùå Firebase Ïó∞Í≤∞ Ï§ë ÏóêÎü¨:', error);
                    setConnected(false);
                    setLoading(false);
                }
            }, []);

            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Î©îÎâ¥ Îã´Í∏∞
            useEffect(() => {
                const handleClickOutside = () => {
                    setShowExpenseMenu({});
                };
                document.addEventListener('click', handleClickOutside);
                return () => document.removeEventListener('click', handleClickOutside);
            }, []);

            // üéñÔ∏è Ïù¥Ïä§ÌÑ∞ÏóêÍ∑∏ Î°úÏßÅ
            const handleTitleClick = () => {
                const newCount = clickCount + 1;
                setClickCount(newCount);
                
                if (newCount === 3) {
                    setShowEasterEgg(true);
                    setEasterEggMessage('üéñÔ∏è ÏäπÏö∞ ÏûÖÎåÄÎåÄÍ∏∞Î∞© üéñÔ∏è');
                } else if (newCount === 5) {
                    setEasterEggMessage('üìÖ D-day: 9Ïõî ÏûÖÎåÄ ÏòàÏ†ï! üí™');
                } else if (newCount === 7) {
                    setEasterEggMessage('ü´° ÎßàÏßÄÎßâ ÏûêÏú†Ïó¨ÌñâÏùÑ Ï¶êÍ≤®Îùº! üèä‚Äç‚ôÄÔ∏è');
                    setTimeout(() => {
                        setShowEasterEgg(false);
                        setClickCount(0);
                    }, 3000);
                }
            };

            // Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§ (ÏïàÏ†Ñ Î≤ÑÏ†Ñ)
            const updateExpenseInFirebase = (expenseId, updates) => {
                if (!database) {
                    console.log('‚ö†Ô∏è Firebase Ïó∞Í≤∞ ÏóÜÏùå, ÏóÖÎç∞Ïù¥Ìä∏ Î∂àÍ∞Ä');
                    alert('Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉúÏûÖÎãàÎã§.');
                    return;
                }
                try {
                    console.log('üîÑ Firebase ÏóÖÎç∞Ïù¥Ìä∏:', { expenseId, updates });
                    database.ref(`expenses/${expenseId}`).update(updates);
                } catch (error) {
                    console.error('Firebase ÏóÖÎç∞Ïù¥Ìä∏ ÏóêÎü¨:', error);
                    alert('ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            };

            const deleteExpenseFromFirebase = (expenseId) => {
                if (!database) {
                    console.log('‚ö†Ô∏è Firebase Ïó∞Í≤∞ ÏóÜÏùå, ÏÇ≠Ï†ú Î∂àÍ∞Ä');
                    alert('Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉúÏûÖÎãàÎã§.');
                    return;
                }
                try {
                    console.log('üóëÔ∏è Firebase ÏÇ≠Ï†ú:', expenseId);
                    database.ref(`expenses/${expenseId}`).remove();
                } catch (error) {
                    console.error('Firebase ÏÇ≠Ï†ú ÏóêÎü¨:', error);
                    alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            };

            const addExpenseToFirebase = (expenseData) => {
                if (!database) {
                    console.log('‚ö†Ô∏è Firebase Ïó∞Í≤∞ ÏóÜÏùå, Ï∂îÍ∞Ä Î∂àÍ∞Ä');
                    alert('Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉúÏûÖÎãàÎã§.');
                    return null;
                }
                try {
                    console.log('‚ûï Firebase Ï∂îÍ∞Ä:', expenseData);
                    const newExpenseRef = database.ref('expenses').push();
                    newExpenseRef.set({
                        ...expenseData,
                        createdAt: Date.now(),
                        completedBy: {}
                    });
                    return newExpenseRef.key;
                } catch (error) {
                    console.error('Firebase Ï∂îÍ∞Ä ÏóêÎü¨:', error);
                    alert('Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    return null;
                }
            };

            // üóëÔ∏è Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
            const clearAllData = () => {
                const userConfirm = window.confirm(`‚ö†Ô∏è Ï†ïÎßê Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏúºÎ©∞, ÌôúÎèô Î°úÍ∑∏ÎèÑ Î™®Îëê ÏÇ¨ÎùºÏßëÎãàÎã§.`);
                
                if (userConfirm) {
                    const doubleConfirm = window.confirm(`üî• ÎßàÏßÄÎßâ ÌôïÏù∏!\n\nÏ†ïÎßêÎ°ú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÍ≥† ÏÉàÎ°ú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
                    
                    if (doubleConfirm) {
                        if (!database) {
                            alert('‚ö†Ô∏è Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉúÏûÖÎãàÎã§.');
                            return;
                        }
                        try {
                            console.log('üóëÔ∏è Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÏãúÏûë...');
                            database.ref('expenses').remove();
                            database.ref('activities').remove();
                            database.ref('pokes').remove();
                            alert('‚úÖ Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!\nÏÉàÎ°úÏö¥ Ïó¨ÌñâÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî! üèä‚Äç‚ôÄÔ∏è');
                        } catch (error) {
                            console.error('Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÏóêÎü¨:', error);
                            alert('‚ùå ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                        }
                    }
                }
            };

            // Ìèº Ìï∏Îì§Îü¨Îì§ (ÌôúÎèô Î°úÍ∑∏ Ï∂îÍ∞Ä Ìè¨Ìï®)
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.title.trim() || !formData.amount) {
                    alert('Ï†úÎ™©Í≥º Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const expenseData = {
                    ...formData,
                    amount: parseInt(formData.amount),
                    participants: [...formData.participants]
                };

                if (editingExpense) {
                    updateExpenseInFirebase(editingExpense.id, expenseData);
                } else {
                    addExpenseWithActivity(expenseData);
                }

                setShowAddForm(false);
                setEditingExpense(null);
                setFormData({
                    title: '',
                    amount: '',
                    payer: members[0],
                    participants: [...members],
                    category: 'food',
                    splitType: 'equal',
                    customSplit: {},
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toTimeString().slice(0, 5)
                });
            };

            // Ï†ïÏÇ∞ Í¥ÄÎ†® Ìï®ÏàòÎì§
            const togglePersonalCompletion = (expenseId, member) => {
                try {
                    console.log('Í∞úÏù∏ Ï†ïÏÇ∞ ÏãúÏûë:', { expenseId, member });
                    
                    const expense = expenses.find(e => e && e.id === expenseId);
                    if (!expense) {
                        console.error('Í≤ΩÎπÑÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå:', expenseId);
                        alert('Í≤ΩÎπÑ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    
                    if (!member || typeof member !== 'string') {
                        console.error('ÏûòÎ™ªÎêú Î©§Î≤Ñ Ïù¥Î¶Ñ:', member);
                        alert('Î©§Î≤Ñ Ï†ïÎ≥¥Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                        return;
                    }
                    
                    const memberAmount = getParticipantAmount(expense, member);
                    console.log('Î©§Î≤Ñ Í∏àÏï°:', memberAmount);
                    
                    const userConfirm = window.confirm(`${member}ÎãòÏùò ${memberAmount.toLocaleString()}Ïõê Ï†ïÏÇ∞ÏùÑ ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
                    
                    if (userConfirm) {
                        const currentCompletedBy = expense.completedBy && typeof expense.completedBy === 'object' ? {...expense.completedBy} : {};
                        const currentStatus = currentCompletedBy[member] === true;
                        
                        currentCompletedBy[member] = !currentStatus;
                        
                        console.log('Ï†ïÏÇ∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏:', { 
                            expenseId, 
                            member, 
                            currentStatus, 
                            newStatus: !currentStatus,
                            newCompletedBy: currentCompletedBy
                        });
                        
                        updateExpenseInFirebase(expenseId, { completedBy: currentCompletedBy });
                    }
                    
                } catch (error) {
                    console.error('Í∞úÏù∏ Ï†ïÏÇ∞ Ï≤òÎ¶¨ ÏóêÎü¨:', error);
                    alert('Ï†ïÏÇ∞ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + (error.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            };

            const toggleExpenseCompletion = (expenseId) => {
                const expense = expenses.find(e => e && e.id === expenseId);
                if (!expense) {
                    alert('Í≤ΩÎπÑ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const isCompleted = isExpenseCompleted(expense);
                
                const message = isCompleted 
                    ? `"${expense.title}" Ìï≠Î™©Ïùò Ï†ÑÏ≤¥ Ï†ïÏÇ∞ÏùÑ Ìï¥Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`
                    : `"${expense.title}" Ìï≠Î™©Ïùò Ï†ÑÏ≤¥ Ï†ïÏÇ∞ÏùÑ ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                
                const userConfirm = window.confirm(message);
                
                if (userConfirm) {
                    try {
                        let newCompletedBy = {};
                        if (!isCompleted && expense.participants) {
                            expense.participants.forEach(participant => {
                                newCompletedBy[participant] = true;
                            });
                        }
                        
                        console.log('Ï†ÑÏ≤¥ Ï†ïÏÇ∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏:', { 
                            expenseId, 
                            isCompleted, 
                            newCompletedBy 
                        });
                        
                        updateExpenseInFirebase(expenseId, { completedBy: newCompletedBy });
                        
                    } catch (error) {
                        console.error('Ï†ÑÏ≤¥ Ï†ïÏÇ∞ Ï≤òÎ¶¨ ÏóêÎü¨:', error);
                        alert('Ï†ïÏÇ∞ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                }
            };

            const deleteExpense = (expenseId, title) => {
                const userConfirm = window.confirm(`"${title}" Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`);
                
                if (userConfirm) {
                    try {
                        console.log('Í≤ΩÎπÑ ÏÇ≠Ï†ú:', { expenseId, title });
                        deleteExpenseFromFirebase(expenseId);
                        setShowExpenseMenu({});
                    } catch (error) {
                        console.error('ÏÇ≠Ï†ú Ï≤òÎ¶¨ ÏóêÎü¨:', error);
                        alert('ÏÇ≠Ï†ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                }
            };

            const isExpenseCompleted = (expense) => {
                try {
                    if (!expense || typeof expense !== 'object') {
                        return false;
                    }
                    
                    const participants = expense.participants;
                    if (!Array.isArray(participants) || participants.length === 0) {
                        return false;
                    }
                    
                    const completedBy = expense.completedBy;
                    if (!completedBy || typeof completedBy !== 'object') {
                        return false;
                    }
                    
                    return participants.every(participant => {
                        if (!participant || typeof participant !== 'string') {
                            return false;
                        }
                        return completedBy[participant] === true;
                    });
                } catch (error) {
                    console.error('isExpenseCompleted ÏóêÎü¨:', error);
                    return false;
                }
            };

            const getParticipantAmount = (expense, member) => {
                try {
                    if (!expense || typeof expense !== 'object' || !member || typeof member !== 'string') {
                        return 0;
                    }
                    
                    const participants = expense.participants;
                    if (!Array.isArray(participants) || !participants.includes(member)) {
                        return 0;
                    }
                    
                    const customSplit = expense.customSplit && typeof expense.customSplit === 'object' ? expense.customSplit : {};
                    
                    if (expense.splitType === 'custom' && customSplit[member] && typeof customSplit[member] === 'number') {
                        return customSplit[member];
                    }
                    
                    const totalAmount = typeof expense.amount === 'number' ? expense.amount : 0;
                    const customTotal = Object.values(customSplit).reduce((sum, val) => {
                        return sum + (typeof val === 'number' ? val : 0);
                    }, 0);
                    
                    const remainingAmount = totalAmount - customTotal;
                    const remainingParticipants = participants.filter(p => 
                        p && typeof p === 'string' && !customSplit[p]
                    );
                    
                    return remainingParticipants.length > 0 ? Math.round(remainingAmount / remainingParticipants.length) : 0;
                } catch (error) {
                    console.error('getParticipantAmount ÏóêÎü¨:', error, { expense, member });
                    return 0;
                }
            };

            const calculatePersonalExpenses = () => {
                try {
                    const personalTotals = {};
                    
                    if (!Array.isArray(members)) {
                        console.error('membersÍ∞Ä Î∞∞Ïó¥Ïù¥ ÏïÑÎãò');
                        return {};
                    }
                    
                    members.forEach(member => {
                        if (member && typeof member === 'string') {
                            personalTotals[member] = { paid: 0, owes: 0, net: 0 };
                        }
                    });

                    const activeExpenses = expenses.filter(expense => {
                        try {
                            return expense && typeof expense === 'object' && !isExpenseCompleted(expense);
                        } catch (error) {
                            console.error('activeExpenses ÌïÑÌÑ∞ ÏóêÎü¨:', error);
                            return false;
                        }
                    });

                    activeExpenses.forEach(expense => {
                        try {
                            if (!expense || typeof expense !== 'object') {
                                return;
                            }
                            
                            const payer = expense.payer;
                            if (payer && typeof payer === 'string' && personalTotals[payer]) {
                                const amount = typeof expense.amount === 'number' ? expense.amount : 0;
                                personalTotals[payer].paid += amount;
                            }
                            
                            const participants = expense.participants;
                            const completedBy = expense.completedBy && typeof expense.completedBy === 'object' ? expense.completedBy : {};
                            
                            if (Array.isArray(participants)) {
                                participants.forEach(participant => {
                                    try {
                                        if (participant && 
                                            typeof participant === 'string' && 
                                            personalTotals[participant] && 
                                            completedBy[participant] !== true) {
                                            
                                            const amount = getParticipantAmount(expense, participant);
                                            if (typeof amount === 'number' && amount >= 0) {
                                                personalTotals[participant].owes += amount;
                                            }
                                        }
                                    } catch (error) {
                                        console.error('participant Ï≤òÎ¶¨ ÏóêÎü¨:', error, { participant, expense });
                                    }
                                });
                            }
                        } catch (error) {
                            console.error('expense Ï≤òÎ¶¨ ÏóêÎü¨:', error, expense);
                        }
                    });

                    Object.keys(personalTotals).forEach(member => {
                        try {
                            if (personalTotals[member] && typeof personalTotals[member] === 'object') {
                                const paid = personalTotals[member].paid || 0;
                                const owes = personalTotals[member].owes || 0;
                                personalTotals[member].net = paid - owes;
                            }
                        } catch (error) {
                            console.error('net Í≥ÑÏÇ∞ ÏóêÎü¨:', error, { member });
                        }
                    });

                    return personalTotals;
                } catch (error) {
                    console.error('calculatePersonalExpenses Ï†ÑÏ≤¥ ÏóêÎü¨:', error);
                    const safeTotals = {};
                    members.forEach(member => {
                        if (member && typeof member === 'string') {
                            safeTotals[member] = { paid: 0, owes: 0, net: 0 };
                        }
                    });
                    return safeTotals;
                }
            };

            // Ï¥ù Í≤ΩÎπÑ Í≥ÑÏÇ∞
            const totalExpenses = expenses.reduce((sum, expense) => sum + (expense.amount || 0), 0);
            const pendingExpenses = expenses.filter(expense => !isExpenseCompleted(expense))
                .reduce((sum, expense) => sum + (expense.amount || 0), 0);

            const personalTotals = calculatePersonalExpenses();

            // Ìèº Ìï∏Îì§Îü¨Îì§
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.title.trim() || !formData.amount) {
                    alert('Ï†úÎ™©Í≥º Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const expenseData = {
                    ...formData,
                    amount: parseInt(formData.amount),
                    participants: [...formData.participants]
                };

                if (editingExpense) {
                    updateExpenseInFirebase(editingExpense.id, expenseData);
                } else {
                    addExpenseToFirebase(expenseData);
                }

                setShowAddForm(false);
                setEditingExpense(null);
                setFormData({
                    title: '',
                    amount: '',
                    payer: members[0],
                    participants: [...members],
                    category: 'food',
                    splitType: 'equal',
                    customSplit: {},
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toTimeString().slice(0, 5)
                });
            };

            const startEdit = (expense) => {
                setEditingExpense(expense);
                setFormData({
                    title: expense.title,
                    amount: expense.amount.toString(),
                    payer: expense.payer,
                    participants: [...expense.participants],
                    category: expense.category,
                    splitType: expense.splitType || 'equal',
                    customSplit: expense.customSplit || {},
                    date: expense.date,
                    time: expense.time
                });
                setShowAddForm(true);
                setShowExpenseMenu({});
            };

            if (loading) {
                return React.createElement('div', { 
                    className: "min-h-screen water-theme flex items-center justify-center" 
                }, 
                    React.createElement('div', { className: "text-center text-white" }, [
                        React.createElement('div', { 
                            key: 'spinner',
                            className: "inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white mb-4" 
                        }),
                        React.createElement('p', { key: 'text' }, "üèä‚Äç‚ôÄÔ∏è ÏºÄÎ¶¨ÎπÑÏïàÎ≤†Ïù¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî©Ï§ë..."),
                        React.createElement('p', { 
                            key: 'tip',
                            className: "text-xs text-white/70 mt-2" 
                        }, "10Ï¥à Ïù¥ÏÉÅ Í±∏Î¶¨Î©¥ ÏÉàÎ°úÍ≥†Ïπ® Ìï¥Ï£ºÏÑ∏Ïöî"),
                        React.createElement('button', {
                            key: 'skip',
                            onClick: () => setLoading(false),
                            className: "mt-4 px-4 py-2 bg-white/20 rounded-lg text-white text-sm hover:bg-white/30"
                        }, "Î°úÎî© Í±¥ÎÑàÎõ∞Í∏∞")
                    ])
                );
            }
                // üèä‚Äç‚ôÄÔ∏è ÏõåÌÑ∞ÌååÌÅ¨ ÌÖåÎßà Ìó§Îçî
                React.createElement('div', { 
                    key: 'header',
                    className: "water-theme shadow-lg sticky top-0 z-10 relative" 
                }, 
                    React.createElement('div', { className: "px-4 py-4" }, [
                        React.createElement('div', { 
                            key: 'title',
                            className: "text-center" 
                        }, [
                            React.createElement('div', {
                                key: 'title-section',
                                className: "easter-egg",
                                onClick: handleTitleClick
                            }, [
                                React.createElement('h1', { 
                                    key: 'h1',
                                    className: "text-xl font-bold text-white drop-shadow-lg" 
                                }, "üèä‚Äç‚ôÄÔ∏è ÏßÑÏßúÎ∞∞Í∏∞ Ïó¨Ìñâ"),
                                React.createElement('p', { 
                                    key: 'subtitle',
                                    className: "text-sm text-white/90 font-medium" 
                                }, "7/24(Î™©) ~ 7/25(Í∏à) ‚Ä¢ ÌéúÏÖò ‚Üí Î∞îÎ≤†ÌÅê ‚Üí ÏºÄÎ¶¨ÎπÑÏïàÎ≤†Ïù¥")
                            ]),
                            // Ïó∞Í≤∞ ÏÉÅÌÉú ÌëúÏãú
                            React.createElement('div', { 
                                key: 'status',
                                className: `flex items-center justify-center gap-1 mt-1 text-xs ${connected ? 'text-white/90' : 'text-red-200'}` 
                            }, [
                                React.createElement('span', { key: 'icon' }, 'üåä'),
                                React.createElement('span', { key: 'text' }, connected ? 'Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®' : '‚ö†Ô∏è Ïó∞Í≤∞ ÎÅäÍπÄ')
                            ]),
                            
                            // üóëÔ∏è Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî Î≤ÑÌäº (ÏûëÍ≤å, Ïò§Î•∏Ï™Ω Íµ¨ÏÑùÏóê)
                            React.createElement('div', {
                                key: 'admin-controls',
                                className: "absolute top-2 right-2 flex items-center gap-2"
                            }, [
                                // üíú Ïó¨ÏûêÏπúÍµ¨ Î∑∞ ÌÜ†Í∏Ä Î≤ÑÌäº
                                React.createElement('button', {
                                    key: 'girlfriend-view',
                                    onClick: () => setShowGirlfriendView(!showGirlfriendView),
                                    className: `text-xs px-3 py-1 rounded transition-all ${
                                        showGirlfriendView 
                                            ? 'bg-pink-500 text-white' 
                                            : 'bg-white/20 hover:bg-white/40 text-white'
                                    }`,
                                    title: showGirlfriendView ? "ÎÇ®ÏûêÎì§ Î∑∞Î°ú Ï†ÑÌôò" : "Ïó¨ÏûêÏπúÍµ¨ Î∑∞Î°ú Ï†ÑÌôò"
                                }, showGirlfriendView ? "üíô ÎÇ®ÏûêÎì§" : "üíú Ïó¨Ïπú"),
                                
                                React.createElement('button', {
                                    key: 'clear-data',
                                    onClick: clearAllData,
                                    className: "text-xs px-2 py-1 bg-red-500/20 hover:bg-red-500/40 text-white rounded opacity-50 hover:opacity-100 transition-opacity",
                                    title: "Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú"
                                }, "üóëÔ∏è")
                            ])
                        ]),
                        React.createElement('div', { 
                            key: 'totals',
                            className: "mt-4 grid grid-cols-2 gap-4" 
                        }, [
                            React.createElement('div', { 
                                key: 'total',
                                className: "text-center water-card rounded-lg p-3" 
                            }, [
                                React.createElement('p', { 
                                    key: 'amount1',
                                    className: "text-xl font-bold text-blue-900 drop-shadow" 
                                }, `${totalExpenses.toLocaleString()}Ïõê`),
                                React.createElement('p', { 
                                    key: 'label1',
                                    className: "text-xs text-blue-700" 
                                }, "Ï¥ù Í≤ΩÎπÑ")
                            ]),
                            React.createElement('div', { 
                                key: 'pending',
                                className: "text-center water-card rounded-lg p-3" 
                            }, [
                                React.createElement('p', { 
                                    key: 'amount2',
                                    className: "text-xl font-bold text-blue-900 drop-shadow" 
                                }, `${pendingExpenses.toLocaleString()}Ïõê`),
                                React.createElement('p', { 
                                    key: 'label2',
                                    className: "text-xs text-blue-700" 
                                }, "ÎØ∏Ï†ïÏÇ∞ Í≤ΩÎπÑ")
                            ])
                        ])
                    ])
                ),

                // üéñÔ∏è Ïù¥Ïä§ÌÑ∞ÏóêÍ∑∏ ÌëúÏãú
                showEasterEgg && React.createElement('div', {
                    key: 'easter-egg',
                    className: "fixed top-20 left-1/2 transform -translate-x-1/2 z-50 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-3 rounded-full shadow-lg animate-bounce"
                }, [
                    React.createElement('div', {
                        key: 'message',
                        className: "text-center font-bold"
                    }, easterEggMessage)
                ]),

                // ÏÉà Í≤ΩÎπÑ Ï∂îÍ∞Ä Î≤ÑÌäº
                React.createElement('div', { 
                    key: 'add-button',
                    className: "p-4" 
                },
                    React.createElement('button', {
                        onClick: () => setShowAddForm(true),
                        className: "w-full water-button text-white rounded-lg py-3 px-4 font-medium flex items-center justify-center gap-2 shadow-lg"
                    }, [
                        React.createElement('span', { key: 'icon' }, '+'),
                        React.createElement('span', { key: 'text' }, "ÏÉà Í≤ΩÎπÑ Ï∂îÍ∞Ä")
                    ])
                ),

                // Í∞úÏù∏Î≥Ñ Ï†ïÏÇ∞ ÌòÑÌô©
                React.createElement('div', { 
                    key: 'personal',
                    className: "mx-4 mb-4" 
                }, [
                    React.createElement('div', { 
                        key: 'header',
                        className: "water-card rounded-lg p-4 shadow-sm" 
                    }, [
                        React.createElement('h2', { 
                            key: 'title',
                            className: "text-lg font-semibold mb-3 text-blue-900 flex items-center gap-2" 
                        }, [
                            React.createElement('span', { key: 'icon' }, 'üë•'),
                            React.createElement('span', { key: 'text' }, "ÌåÄÏõêÎ≥Ñ Ï†ïÏÇ∞ ÌòÑÌô©")
                        ]),
                        React.createElement('div', { 
                            key: 'grid',
                            className: "grid grid-cols-2 gap-2 text-sm" 
                        },
                            members.map(member => {
                                const totals = personalTotals[member] || { paid: 0, owes: 0, net: 0 };
                                const isPositive = totals.net > 0;
                                const isZero = totals.net === 0;
                                
                                return React.createElement('div', { 
                                    key: member,
                                    className: "p-3 rounded border water-card" 
                                }, [
                                    React.createElement('div', { 
                                        key: 'name',
                                        className: "font-medium text-blue-900 flex items-center gap-1" 
                                    }, [
                                        React.createElement('span', { key: 'icon' }, member === 'ÏäπÏö∞' ? 'üéñÔ∏è' : 'üèä‚Äç‚ôÄÔ∏è'),
                                        React.createElement('span', { key: 'text' }, member)
                                    ]),
                                    React.createElement('div', { 
                                        key: 'amount',
                                        className: `text-xs mt-1 ${
                                            isZero ? 'text-gray-600' : 
                                            isPositive ? 'text-green-600' : 'text-red-600'
                                        }` 
                                    }, `${Math.abs(totals.net).toLocaleString()}Ïõê${isZero ? '' : isPositive ? ' Î∞õÏùÑ Îèà' : ' Ï§Ñ Îèà'}`)
                                ]);
                            })
                        )
                    ])
                ]),

                // Í≤ΩÎπÑ ÎÇ¥Ïó≠ Î¶¨Ïä§Ìä∏
                React.createElement('div', { 
                    key: 'expenses-list',
                    className: "mx-4 space-y-3 relative" 
                },
                    expenses.length === 0 
                        ? React.createElement('div', { 
                            key: 'empty',
                            className: "text-center py-8 text-gray-500" 
                        }, [
                            React.createElement('p', { key: 'text' }, "üèä‚Äç‚ôÄÔ∏è ÏïÑÏßÅ Í≤ΩÎπÑÍ∞Ä ÏóÜÏäµÎãàÎã§"),
                            React.createElement('p', { key: 'sub', className: "text-sm" }, "Ï≤´ Í≤ΩÎπÑÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!")
                        ])
                        : expenses.map(expense => {
                            const category = categories.find(c => c.id === expense.category) || categories[4];
                            const isCompleted = isExpenseCompleted(expense);
                            
                            return React.createElement('div', { 
                                key: expense.id,
                                className: `water-card rounded-lg shadow-sm relative overflow-visible ${isCompleted ? 'opacity-60' : ''}`,
                                style: { zIndex: showExpenseMenu[expense.id] ? 60 : 1 }
                            }, [
                                React.createElement('div', { 
                                    key: 'main',
                                    className: "p-4" 
                                }, [
                                    React.createElement('div', { 
                                        key: 'header',
                                        className: "flex items-center justify-between mb-2" 
                                    }, [
                                        React.createElement('div', { 
                                            key: 'left',
                                            className: "flex items-center gap-3" 
                                        }, [
                                            React.createElement('span', { 
                                                key: 'icon',
                                                className: "text-xl" 
                                            }, category.icon),
                                            React.createElement('div', { key: 'info' }, [
                                                React.createElement('h3', { 
                                                    key: 'title',
                                                    className: `font-medium text-blue-900 ${isCompleted ? 'line-through' : ''}` 
                                                }, expense.title),
                                                React.createElement('p', { 
                                                    key: 'meta',
                                                    className: "text-xs text-blue-700" 
                                                }, `${expense.payer} Í≤∞Ï†ú ‚Ä¢ ${expense.date} ${expense.time}`)
                                            ])
                                        ]),
                                        React.createElement('div', { 
                                            key: 'right',
                                            className: "text-right" 
                                        }, [
                                            React.createElement('p', { 
                                                key: 'amount',
                                                className: `text-lg font-bold text-blue-900 ${isCompleted ? 'line-through' : ''}` 
                                            }, `${expense.amount.toLocaleString()}Ïõê`),
                                            React.createElement('button', {
                                                key: 'menu',
                                                onClick: (e) => {
                                                    e.stopPropagation();
                                                    setShowExpenseMenu(prev => ({
                                                        ...prev,
                                                        [expense.id]: !prev[expense.id]
                                                    }));
                                                },
                                                className: "p-1 text-blue-600 hover:bg-blue-100 rounded"
                                            }, React.createElement('span', { className: "text-xs" }, '‚ãÆ'))
                                        ])
                                    ]),
                                    
                                    // Î©îÎâ¥ Î∞∞Í≤Ω Ïò§Î≤ÑÎ†àÏù¥ + Î©îÎâ¥
                                    showExpenseMenu[expense.id] && React.createElement('div', {
                                        key: 'menu-overlay',
                                        className: "fixed inset-0 z-40",
                                        onClick: () => setShowExpenseMenu({})
                                    }),
                                    
                                    showExpenseMenu[expense.id] && React.createElement('div', { 
                                        key: 'menu',
                                        className: "menu-dropdown absolute right-0 top-8 rounded-lg py-1 z-50 min-w-[140px]",
                                        style: {
                                            marginTop: '4px'
                                        },
                                        onClick: (e) => e.stopPropagation()
                                    }, [
                                        React.createElement('button', {
                                            key: 'edit',
                                            onClick: () => startEdit(expense),
                                            className: "menu-item w-full px-4 py-3 text-left hover:bg-blue-50 flex items-center gap-2 text-sm border-b border-gray-100 last:border-b-0"
                                        }, [
                                            React.createElement('span', { key: 'icon' }, '‚úèÔ∏è'),
                                            React.createElement('span', { key: 'text' }, "ÏàòÏ†ï")
                                        ]),
                                        React.createElement('button', {
                                            key: 'complete',
                                            onClick: () => toggleExpenseCompletion(expense.id),
                                            className: "menu-item w-full px-4 py-3 text-left hover:bg-green-50 flex items-center gap-2 text-sm border-b border-gray-100 last:border-b-0"
                                        }, [
                                            React.createElement('span', { key: 'icon' }, '‚úì'),
                                            React.createElement('span', { key: 'text' }, isCompleted ? "Ï†ïÏÇ∞ Ìï¥Ï†ú" : "Ï†ÑÏ≤¥ ÏôÑÎ£å")
                                        ]),
                                        React.createElement('button', {
                                            key: 'delete',
                                            onClick: () => deleteExpense(expense.id, expense.title),
                                            className: "menu-item w-full px-4 py-3 text-left hover:bg-red-50 flex items-center gap-2 text-sm text-red-600"
                                        }, [
                                            React.createElement('span', { key: 'icon' }, 'üóëÔ∏è'),
                                            React.createElement('span', { key: 'text' }, "ÏÇ≠Ï†ú")
                                        ])
                                    ]),

                                    // Ï†ïÏÇ∞ Ï†ïÎ≥¥
                                    React.createElement('div', { 
                                        key: 'settlement',
                                        className: "flex items-center justify-between text-sm mt-3 pt-3 border-t border-blue-100" 
                                    }, [
                                        React.createElement('div', { 
                                            key: 'participants',
                                            className: "flex items-center gap-2" 
                                        }, [
                                            React.createElement('span', { 
                                                key: 'label',
                                                className: "text-blue-700" 
                                            }, "Ï∞∏Ïó¨Ïûê:"),
                                            React.createElement('span', { 
                                                key: 'count',
                                                className: "text-blue-900 font-medium" 
                                            }, `${expense.participants?.length || 0}Î™Ö`)
                                        ]),
                                        React.createElement('div', { 
                                            key: 'status',
                                            className: "flex items-center gap-2" 
                                        }, [
                                            React.createElement('button', {
                                                key: 'toggle',
                                                onClick: () => setExpandedExpenses(prev => ({
                                                    ...prev,
                                                    [expense.id]: !prev[expense.id]
                                                })),
                                                className: "text-blue-600 hover:text-blue-800 flex items-center gap-1"
                                            }, [
                                                React.createElement('span', { key: 'text' }, "Í∞úÎ≥Ñ Ï†ïÏÇ∞"),
                                                React.createElement(expandedExpenses[expense.id] ? ChevronUp : ChevronDown, { 
                                                    key: 'icon',
                                                    size: 16 
                                                })
                                            ]),
                                            (() => {
                                                try {
                                                    if (!expense || !Array.isArray(expense.participants)) {
                                                        return React.createElement('span', { 
                                                            key: 'completed',
                                                            className: "text-xs text-gray-500" 
                                                        }, "0/0Î™Ö");
                                                    }
                                                    const completedBy = expense.completedBy && typeof expense.completedBy === 'object' ? expense.completedBy : {};
                                                    const completedCount = expense.participants.filter(p => {
                                                        return p && typeof p === 'string' && completedBy[p] === true;
                                                    }).length;
                                                    return React.createElement('span', { 
                                                        key: 'completed',
                                                        className: "text-xs text-blue-700" 
                                                    }, `${completedCount}/${expense.participants.length}Î™Ö`);
                                                } catch (error) {
                                                    console.error('completedCount Í≥ÑÏÇ∞ ÏóêÎü¨:', error);
                                                    return React.createElement('span', { 
                                                        key: 'completed',
                                                        className: "text-xs text-gray-500" 
                                                    }, "0/0Î™Ö");
                                                }
                                            })()
                                        ])
                                    ]),

                                    // Í∞úÎ≥Ñ Ï†ïÏÇ∞ ÏÑ∏Î∂ÄÏÇ¨Ìï≠
                                    expandedExpenses[expense.id] && expense.participants && Array.isArray(expense.participants) && React.createElement('div', { 
                                        key: 'details',
                                        className: "grid grid-cols-2 gap-1 text-xs mt-2 pt-2 border-t border-blue-100" 
                                    },
                                        expense.participants.map(participant => {
                                            try {
                                                if (!participant || typeof participant !== 'string') {
                                                    return null;
                                                }
                                                
                                                const amount = getParticipantAmount(expense, participant);
                                                const completedBy = expense.completedBy && typeof expense.completedBy === 'object' ? expense.completedBy : {};
                                                const isCompleted = completedBy[participant] === true;
                                                
                                                return React.createElement('div', { 
                                                    key: participant,
                                                    className: `flex items-center justify-between p-2 rounded border ${
                                                        isCompleted ? 'bg-green-50 border-green-200' : 'bg-blue-50 border-blue-200'
                                                    }` 
                                                }, [
                                                    React.createElement('span', { 
                                                        key: 'name',
                                                        className: isCompleted ? 'text-green-700 line-through' : 'text-blue-700' 
                                                    }, [
                                                        participant === 'ÏäπÏö∞' ? 'üéñÔ∏è ' : 'üèä‚Äç‚ôÄÔ∏è ',
                                                        participant
                                                    ]),
                                                    React.createElement('div', { 
                                                        key: 'amount',
                                                        className: "flex items-center gap-1" 
                                                    }, [
                                                        React.createElement('span', { 
                                                            key: 'value',
                                                            className: isCompleted ? 'text-green-700 line-through' : 'text-blue-700' 
                                                        }, `${amount.toLocaleString()}Ïõê`),
                                                        React.createElement('button', {
                                                            key: 'check',
                                                            onClick: () => togglePersonalCompletion(expense.id, participant),
                                                            className: `p-1 rounded mobile-button ${
                                                                isCompleted 
                                                                    ? 'text-green-600 hover:text-green-700' 
                                                                    : 'text-blue-400 hover:text-blue-600'
                                                            }`
                                                        }, React.createElement(Check))
                                                    ])
                                                ]);
                                            } catch (error) {
                                                console.error('participant Î†åÎçîÎßÅ ÏóêÎü¨:', error, { participant, expense });
                                                return null;
                                            }
                                        }).filter(Boolean)
                                    )
                                ])
                            ]);
                        })
                ),

                // ÏÉà Í≤ΩÎπÑ Ï∂îÍ∞Ä Ìèº
                showAddForm && React.createElement('div', { 
                    key: 'form-overlay',
                    className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" 
                },
                    React.createElement('div', { 
                        className: "water-card rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto" 
                    }, [
                        React.createElement('h2', { 
                            key: 'form-title',
                            className: "text-lg font-semibold mb-4 text-blue-900" 
                        }, editingExpense ? "Í≤ΩÎπÑ ÏàòÏ†ï" : "ÏÉà Í≤ΩÎπÑ Ï∂îÍ∞Ä"),
                        
                        React.createElement('form', { 
                            key: 'form',
                            onSubmit: handleSubmit,
                            className: "space-y-4" 
                        }, [
                            // Ï†úÎ™©
                            React.createElement('div', { key: 'title-field' }, [
                                React.createElement('label', { 
                                    key: 'label',
                                    className: "block text-sm font-medium text-blue-900 mb-1" 
                                }, "Ï†úÎ™©"),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'text',
                                    value: formData.title,
                                    onChange: (e) => setFormData(prev => ({ ...prev, title: e.target.value })),
                                    className: "w-full px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                                    placeholder: "Ïòà: ÌéúÏÖò Î∞îÎ≤†ÌÅê Í≥†Í∏∞Í∞í"
                                })
                            ]),

                            // Í∏àÏï°
                            React.createElement('div', { key: 'amount-field' }, [
                                React.createElement('label', { 
                                    key: 'label',
                                    className: "block text-sm font-medium text-blue-900 mb-1" 
                                }, "Í∏àÏï°"),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'number',
                                    value: formData.amount,
                                    onChange: (e) => setFormData(prev => ({ ...prev, amount: e.target.value })),
                                    className: "w-full px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                                    placeholder: "0"
                                })
                            ]),

                            // Í≤∞Ï†úÏûê
                            React.createElement('div', { key: 'payer-field' }, [
                                React.createElement('label', { 
                                    key: 'label',
                                    className: "block text-sm font-medium text-blue-900 mb-1" 
                                }, "Í≤∞Ï†úÏûê"),
                                React.createElement('select', {
                                    key: 'select',
                                    value: formData.payer,
                                    onChange: (e) => setFormData(prev => ({ ...prev, payer: e.target.value })),
                                    className: "w-full px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                }, members.map(member => 
                                    React.createElement('option', { 
                                        key: member,
                                        value: member 
                                    }, member === 'ÏäπÏö∞' ? `üéñÔ∏è ${member}` : `üèä‚Äç‚ôÄÔ∏è ${member}`)
                                ))
                            ]),

                            // Ïπ¥ÌÖåÍ≥†Î¶¨
                            React.createElement('div', { key: 'category-field' }, [
                                React.createElement('label', { 
                                    key: 'label',
                                    className: "block text-sm font-medium text-blue-900 mb-1" 
                                }, "Ïπ¥ÌÖåÍ≥†Î¶¨"),
                                React.createElement('select', {
                                    key: 'select',
                                    value: formData.category,
                                    onChange: (e) => setFormData(prev => ({ ...prev, category: e.target.value })),
                                    className: "w-full px-3 py-2 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                }, categories.map(category => 
                                    React.createElement('option', { 
                                        key: category.id,
                                        value: category.id 
                                    }, `${category.icon} ${category.name}`)
                                ))
                            ]),

                            // Ï∞∏Ïó¨Ïûê
                            React.createElement('div', { key: 'participants-field' }, [
                                React.createElement('label', { 
                                    key: 'label',
                                    className: "block text-sm font-medium text-blue-900 mb-1" 
                                }, "Ï∞∏Ïó¨Ïûê"),
                                React.createElement('div', { 
                                    key: 'checkboxes',
                                    className: "grid grid-cols-2 gap-2" 
                                }, members.map(member => 
                                    React.createElement('label', { 
                                        key: member,
                                        className: "flex items-center gap-2 cursor-pointer" 
                                    }, [
                                        React.createElement('input', {
                                            key: 'checkbox',
                                            type: 'checkbox',
                                            checked: formData.participants.includes(member),
                                            onChange: (e) => {
                                                if (e.target.checked) {
                                                    setFormData(prev => ({
                                                        ...prev,
                                                        participants: [...prev.participants, member]
                                                    }));
                                                } else {
                                                    setFormData(prev => ({
                                                        ...prev,
                                                        participants: prev.participants.filter(p => p !== member)
                                                    }));
                                                }
                                            },
                                            className: "rounded border-blue-300 text-blue-600 focus:ring-blue-500"
                                        }),
                                        React.createElement('span', { 
                                            key: 'name',
                                            className: "text-sm text-blue-900" 
                                        }, member === 'ÏäπÏö∞' ? `üéñÔ∏è ${member}` : `üèä‚Äç‚ôÄÔ∏è ${member}`)
                                    ])
                                ))
                            ]),

                            // Î≤ÑÌäºÎì§
                            React.createElement('div', { 
                                key: 'buttons',
                                className: "flex gap-3 pt-4" 
                            }, [
                                React.createElement('button', {
                                    key: 'cancel',
                                    type: 'button',
                                    onClick: () => {
                                        setShowAddForm(false);
                                        setEditingExpense(null);
                                    },
                                    className: "flex-1 px-4 py-2 border border-blue-300 rounded-lg text-blue-700 hover:bg-blue-50"
                                }, "Ï∑®ÏÜå"),
                                React.createElement('button', {
                                    key: 'submit',
                                    type: 'submit',
                                    className: "flex-1 px-4 py-2 water-button text-white rounded-lg"
                                }, editingExpense ? "ÏàòÏ†ï" : "Ï∂îÍ∞Ä")
                            ])
                        ])
                    ])
            ]);
        }

        // React 18 Ìò∏Ìôò Î†åÎçîÎßÅ
        const container = document.getElementById('root');
        if (typeof ReactDOM.createRoot === 'function') {
            // React 18
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(App));
        } else {
            // React 17 fallback
            ReactDOM.render(React.createElement(App), container);
        }
        }

        // React 18 Ìò∏Ìôò Î†åÎçîÎßÅ
        const container = document.getElementById('root');
        if (typeof ReactDOM.createRoot === 'function') {
            // React 18
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(App));
        } else {
            // React 17 fallback
            ReactDOM.render(React.createElement(App), container);
        }
    </script>
</body>
</html>
